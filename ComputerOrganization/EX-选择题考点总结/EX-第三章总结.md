# EX-第三章总结

## 导读

### 【考纲内容】

1. **存储器的分类**
2. **层次化存储器的基本结构**
3. **半导体随机存取存储器**：$SRAM$、$DRAM$、$Flash$存储器
4. **主存储器**：$DRAM$芯片和内存条、多模块存储器、主存和 $CPU$之间的连接
5. **外部存储器**：磁盘存储器、固态硬盘$SSD$
6. **高速缓冲存储器**
    1. $Cache $的基本原理
    2. $Cache $和主存之间的映射方式
    3. $Cache $中主存块的替换算法;
    4. $Cache $写策略
7. **虚拟存储器**
    1. 虚拟存储器的基本概念
    2. 页式虚拟存储器：基本原理、页表、地址转换、快表$TLB $
    3. 段式虚拟存储器的基本原理
    4. 段页式虚拟存储器的基本原理

### 【复习提示】

本章是历年命题重点，特别是**有关$Cache $和虚拟存储器的考点**容易出综合题。

此外，**存储器的特点，存储器的扩展（芯片选择、连接方式、地址范围等），交叉存储器，$Cache $的相关计算与替换算法，虚拟存储器与快表也容易出选择题**。

**需掌握存在 $Cache $和 $TLB $的计算机中的地址翻译与 $Cache$ 映射问题**。

## 选择题考点总结

### 存储器的分类

1.   按作用分类：主存储器、辅助存储器、高速缓冲存储器$Cache$。
2.   按存取方式分类
     1.   随机存取：**与存储单元的物理位置无关**
          1.   随机存取存储器$RAM(Random\;Access\;Memory)$
               + 动态随机存取存储$DRAM$
               + 静态随机存取存储$SRAM$
          2.   只读存储器$ROM(Read-Only\;Memory)$
          3.   相联存储器$CAM(Content-Addressable\;Memory)$
     2.   串行访问：**读写某个存储单元所需时间与存储单元的物理位置有关**
          1.   直接存取$DAM$：磁盘。
          2.   顺序存取$SAM$：磁带。
3.   按存储介质分类
     1.   磁表面存储器：磁盘、磁带。
     2.   磁芯存储器。$MOS$型存储器、双极型存储器。
     3.   光存储器：光盘。
     4.   半导体存储器。
4.   按信息可保存性分类
     1.   断电后信息是否消失：
          + 易失性：$RAM(Cache，$主存$)$。
          + 非易失性：磁带、$ROM$。
     2.   破坏性，存取是否影响存储内存：
          + 破坏性读出：$DRAM$。
          + 非破坏性读出：$SRAM$

### 存储器概述

1.   存储器性能指标
     1.   存储容量：存储字数×字长（如$1M\times8$位）。
     2.   单位成本：每位价格=总成本÷总容量。

     3.   主存带宽（$B_m$）：主存带宽又称数据传输率，表示每秒从主存进出信息的最大数量，单位为字/秒、字节/秒（$B/s$）或位/秒（$b/s$）。

     4.   存储速度：数据传输率=数据的宽度(单位$B$)÷存储周期，其中存储周期=存取时间+恢复时间。
          1.   存取时间（$T_a$）：存取时间是指从启动一次存储器操作到完成该操作所经历平均的时间，分为读出时间和写入时间。
          2.   存取周期（$T_m$）：存取周期又称为读写周期或访问周期。它是指存储器进行一次完整的读写操作所需的金部时间，即连续两次独立地访问存储器操作（读或写操作）之间所需的最小时间间隔。
2.   存储器层次化结构：$CPU\to Cache\to$主存$\to$辅存$\to$虚拟存储系统。
     1.   在主存和$CPU$之间插入$Cache$是为了解决$CPU$的高速与主存之间的低速速度不匹配的问题，由硬件自动完成
     2.   在虚拟存储系统和主存之间插入辅存是为了解决主存容量不足的问题，由硬件和操作系统共同完成。
     3.   主存和$	Cache$之间的数据调动是由硬件自动完成的，对所有程序员均是透明的
     4.   而主存和辅存之间的数据调动则是由硬件和操作系统共同完成的，对应用程序员是透明的。

### 主存储器

![image-20231028180236086](https://trouvaille-oss.oss-cn-beijing.aliyuncs.com/picList/202310281802172.png)

1.   静态随机存储器$SRAM$：使用双稳态触发器六晶体管$MOS$来记忆信息，因此即使信息被读出后，仍保持其原状态而不需要再生，即非破坏性读出。$SRAM$的存取速度快，但集成度低，功耗较大，价格昂贵，一般用于高速缓冲存储器。
2.   动态随机存储器$DRAM$​：利用存储元电路中栅极电容上的电荷来存储信息的，$DRAM$的基本存储元通常只使用一个晶体管，所以它比$SRAM$的密度要高很多。$DRAM$容易集成、位价低、容量大和功耗低，但$DRAM$的存取速度较慢，一般用于大容量的主存系统。
     +   地址引脚复用：DRAM芯片容量较大，地址位数较多，为减少芯片的地址引脚数，采用地址引脚复用技术，**将地址拆分为行列地址**（$DRAM$行、列地址等长），这样地址引脚数可减少一半（**数据引脚数不减少**）。
         +   $SRAM$需要$2^n$条地址线，而$DRAM$需要$2^{\frac{n}{2}+1}$根地址线。
3.   $DRAM$的刷新：即使电源不断电，信息也会自动消失，故每隔一定时间必须刷新。
     1.   刷新周期：从上一次刷新结束到下一次对整个$DRAM$全部刷新一遍为止，一般为$2ms$。
     2.   刷新单元数：以行为单元，每次刷新一行存储单元。
     3.   刷新方式：硬件支持，读出一行的信息后重新写入整个行，占用一个读/写周期。
     4.   刷新时刻：内存只有⼀套地址译码和⽚选装置，刷新与存取有相似的过程，故么刷新与存取不能并⾏，刷新操作之间也不能并行。
          1.   集中刷新：有一段时间专门刷新，但是这时候就无法访问存储器，必须停⽌读/写操作，称为**访存死区**，该段时间为**死时间**。读写时间不受刷新工作的影响，但是存在死区。
          2.   分散刷新：每读取完一行数据就刷新一次。没有死区，但是加长了系统存取周期，降低整机速度。
          3.   异步刷新：隔一段时间刷新一次，一次要刷新所有的行，缩短了“死时间”，但任然存在“死时间”。可以避免使$CPU$连续等待过长的时间，而且减少了刷新次数，从根本上提高了整机的工作效率。
4.   ※$SRAM$和$DRAM$的引脚数：对于容量为$N\times M$位的存储器，其中$N=2^n$为存储单元个数，$M$为存储字长
     1.   $DRAM$使用地址线复用技术，地址线线路引脚数减少一半：地址线引脚数为$\frac{n}{2}$，数据线引脚数为$M$，读写控制线引脚数为$2$，需要一根行通选线和一根列通选线共两根。
     2.   $SRAM$未使用地址线复用技术：地址线引脚数为$n$，数据线引脚数为$M$，读写控制线引脚数为$2$，只需要一根片选线

### 只读存储器$ROM$

#### $ROM$的种类

只读存储器$ROM$**均为非易失性，断电后数据不会丢失**；结构简单，位密度比可读写存储器高

1.   掩模式只读存储器$MROM (Mask\;Read-Only\;Memory)$ ：厂家按照客户需求，在芯片生产过程中直接写入信息，之后任何人**不可重写，只能读出，无法修改**。可靠性高、灵活性差、生产周期长、只适合批量定制。
2.   可编程只读存储器$PROM (Programmable\;Read-Only\;Memory)$ ：用户可用专门的$PROM$写入器写入信息，之后无法修改
3.   可擦除只读存储器$EPROM (Erasable\;Programmable\;Read-Only\;Memory)$ ：允许用户写入信息，之后用某种方法擦除数据，**可进行多次重写**。不能取代$RAM$，因为$EPROM$的编程次数有限，且写入时间过长。
     1.   光可擦除只读存储器$UVEPROM (Ultraviolet\;Rays，$紫外线$)$ ：**擦除所有信息，无法特定擦除**
     2.   电可擦除只读存储器$EEPROM$(也常记为$E^2PROM$，第一个$E$是$Electrically$)：可用“电擦除”的方式擦除特定的字
4.   闪速存储器$Flash Memory$ ：在$EEPROM $基础上发展而来， 断电后也能保存信息，且**可进行多次快速擦除重写**。**U盘、SD卡就是闪存**。
     +  由于闪存需要先擦除再写入，因此**闪存的写速度比读速度要慢**
5.   固态硬盘$SSD (Solid \;State \;Drives)$ ：由控制单元+存储单元($Flash $芯片)构成，与闪速存储器的核心区别在于控制单元不一样，但存储介质都类似，**可进行多次快速擦除重写**。$SSD$速度快、功耗低、价格高。

#### 多模块存储器

1.   单体多字存储器：普通存储器是每行为一个存储单元，而对于单体多字存储器来说，每个存储单元存储$m$个字，若总线宽度也为$m$个字，则一次并行就能读出$m$个字。**但是只有数据和指令是连续存放在内存的才能这样操作，转移指令无效**。
2.   多体并行存储器：每个模块都有相同的容量和存取速度，以及独立的读写控制电路、地址寄存器和数据寄存器。地址分为体号和体内地址两个部分。对读取数据进行优化。（不是对传输数据）。

---

1.   高位交叉编址的多体存储器：高位是体号，低位是体内地址。**只是相当于扩容而已，对于速度没有改变**。对于连续访问连续地址时，只能一个个访问周期依次访问。若连续取$n$个存储字，每次访问需要$T$的时间，则耗时$nT$。
     +   可以理解成多根内存条，高位(体号)表示访问内存条编号，低位是体内地址
2.   低位交叉编址的多体存储器：**根据历年408真题的描述，交叉编址方式默认指低位交叉编址**。低位是体号，高位是体内地址。使用交叉存放，很好地满足了程序的局部性原理。**存储周期=总线周期×模块数**。
     1.   可以理解成多根内存条，低位(体号)表示访问内存条编号，高位是体内地址。
     2.   若模块字长等于数据总线宽度，模块存取一个字的存取周期为$T$，**总线传送周期(存取时间)**为$r$，所以存储器交叉模块数应该大于等于**交叉存取度**$m=\frac{T}{r}$。启动该模块后能保证经过$m\times r$的时间后再次使用该模块时上次存取操作已经完成。
     3.   若连续取$n$个存储字，每次访问需要$T$的时间，启动间隔为$\tau$，则耗时$T+(n-1)\tau$。

![image-20231028182548266](https://trouvaille-oss.oss-cn-beijing.aliyuncs.com/picList/202310281825377.png)

### 主存储器与$CPU$的连接

1.   位扩展法：增加存储器的位数，而字的数量不变。是将多个存储芯片的地址端、片选端和读写控制端相应并联，数据端分别引出。相当于上面低位交叉编址的多体存储器中每次读取每个内存条的数据。
     1.   地址总线和片选线都是并联的，数据总线连接在每一块芯片上。
     2.   因为需要拓展位，所以一次性需要处理所有芯片的数据，从而需要对芯片同时进行片选线同步信号，所以所有芯片的$\overline{CS}$都可以连接在一起。
     3.   每个芯片各输入输出一部分数据。
     4.   芯片地址分配时将每列并联的一组芯片视为同一个地址组
2.   字扩展法：增加存储器中字的数量（数据的地址大小即能保存的数据的数量），而位数不变。将芯片的地址线、数据线、读写控制线相应并联，而由片选信号来区分各芯片的地址范围。 但是如果每个芯片同时输入输出输数据则$CPU$无法区分到底是哪个芯片存储的数据，所以不能再将片选线连在一起同时控制。

![image-20230831215340072](https://trouvaille-oss.oss-cn-beijing.aliyuncs.com/picList/202308312153187.png)

3.   字位同时扩展法：各芯片连接地址线的方式相同，但是连接数据线的方式不同，需要通过片选信号$\overline{CS}$或采用译码器设计连接到对应芯片。

![image-20230531221233861](https://trouvaille-oss.oss-cn-beijing.aliyuncs.com/picList/image-20230531221233861.png)

4.   存储芯片片选：要实现对存储单元的访问，首先要选择存储芯片，即进行片选；然后为选中的芯片依地址码选择相应的存储单元，以进行数据的存取，即进行字选。
     1.   线选法：当某地址线信息为`0`时，就选中与之对应的存储芯片，只能一位有效。不需要地址译码器，线路简单。但地址空间不连续，选片的地址线必须分时为低电平（否则不能工作)，不能充分利用系统的存储器空间，造成地址资源浪费。
     2.   译码片选法：由于译码器可以将$n$位映射到$2^n$位，通过地址译码芯片产生片选信号。地址空间可连续，可以增加逻辑设计。但电路逻辑复杂。

### 外部存储器

1.   独立冗余磁盘阵列$RAID $：指将多个独立的物理磁盘组成一个独立的逻辑盘，数据在多个物理内上分割交叉存储、并行访问，具有更好的存储性能、可靠性和安全性。无论何时有磁盘损坏，都可随时拔出受损的磁盘再插入好的磁盘，而数据不会损坏，提升了系统的可靠性。
     1.   $RAID0$： 无冗余和无校验的磁盘阵列。无容错能力。
     2.   $RAID1$： 镜像磁盘阵列。有容错能力，但成本翻倍。
     3.   $RAID2$： 采用纠错的海明码的磁盘阵列。
     4.   $RAID3$： 位交叉奇偶校验的磁盘阵列。
     5.   $RAID4$： 块交叉奇偶校验的磁盘阵列。
     6.   $RAID5$： 无独立校验的奇偶校验磁盘阵列。

2.   固态硬盘$SSD$：属于电可擦除$ROM$，即$EEROM$。使用$Flash $芯片**可进行多次快速擦除重写**。 由于$Flash $需要先擦除再写入，因此**写速度比读速度要慢**。
     1.   组成：闪存翻译层（负责管理闪存芯片中的数据存储和访问，找到对应的页$Page$）和存储单元（$Flash $芯片，每个芯片包含多个块$Block$，每个块包含多个页$Page$）
     2.   读写性能特性：
          1.   以页$Page$为单位读/写：相当于磁盘的扇区
          2.   以块$Block$为单位"擦除"，擦干净的块，其中的每页都可以写一次，读无限次
          3.   支持随机访问，系统给定一个逻辑地址，闪存翻译层可通过电路迅速定位到对应的物理地址
          4.   读快、写慢。要写的页如果有数据，则不能写入，需要将块内其他页全部复制到一个新的（擦除过的）块中，再写入新的页
     3.   与机械硬盘相比的特点：
          1.   $SSD$读写速度快，随机访问性能高，用电路控制访问位置；机械硬盘通过移动磁背旋转磁盘控制访可位直，有寻道的间和旋转延达
          2.   $SSD$安静无噪音、耐摔抗震、能耗低、造价更贵
          3.   $SSD$的一个"块"被擦除次数过多（重复写同一个块）可能会坏掉而机械硬盘的扇区不会因为写的次数太多而坏掉
     4.   磨损均衡技术：将“擦除”平均分布在各个块上，以提升使用寿命
          1.   动态磨损均衡：写入数据时，优先选择累计擦除次数少的新闪存块
          2.   静态磨损均衡：$SSD$监测并自动进行数据分配、迁移，让老旧的闪存块承担以读为主的储存任务，让较新的闪存块承担更多的写任务

### 高速缓冲存储器$Cache$