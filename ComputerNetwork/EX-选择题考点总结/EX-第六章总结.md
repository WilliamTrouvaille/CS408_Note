# EX-第六章总结

## 导读

### 【考纲内容】

1.   网络应用模型
     +   客户/服务器模型$P2P$模型
2.   域名系统$DNS$
     +   层次域名空间
     +   域名服务器
     +   域名解析过程
3.   文件传输协议$FTP$
     +   $FTP$的工作原理
     +   控制连接与数据连接
4.   电子邮件$E-mail$
     +   电子邮件系统的组成结构
     +   电子邮件格式与$MIME$
     +   $SMTP$与$POP3$
5.   万维网$WWW$
     +   $WWW$的概念与组成结构
     +   $HTTP$

### 【复习提示】

+   本章内容既可以以选择题的形式考查，也可以结合其他章节的内容出综合题
+   所以牢固掌握本章的几个典型应用层协议是关键

## 选择题总结

### 网络应用模型

1.   $C/S$模型：客户/服务器$C/S(Client/Server)$模型中服务器提供计算服务的设备，而客户指请求计算服务的主机。
     1.   $C/S$模型中，有一个总是打开的主机称为服务器，它服务于许多来自其他称为客户机的主机请求。其工作流程如下
          1.   服务器处于接收请求的状态。
          2.   客户机发出服务请求，并等待接收结果。
               +   客户程序必须知道服务器程序的地址，因为客户机上一般不需要特殊的硬件和复杂的操作系统。 
          3.   服务器收到请求后，分析请求，进行必要的处理，得到结果并发送给客户机。
               +   服务器程序不需要知道客户程序的地址，因为系统启动后即自动调用并一直不断地运行着，被动地等待并接收来自各地客户的请求
     2.   服务器的特点：永久提供服务。永久访问地址/域名。服务器性能的好坏决定了整个系统的性能。

     3.   客户机的特点：与服务器通信，使用服务器提供的服务。间歇接入网络。可能使用动态$IP$地址。**客户机相互之间不直接通信**。
     4.   客户/服务器模型最主要的特征是：客户是服务请求方，服务器是服务提供方。
     5.   常见的使用客户/服务器模型的应用包括$Web$、文件传输协议$FTP$、远程登录和电子邮件等。
2.   $P2P$对等模型：整个网络中的传输内容不再被保存在中心服务器上，每个结点都同时具有下载、上传的功能，其权利和义务都是大体对等的。各计算机没有固定的客户和服务器划分。相反，任意一对计算机，称为对等方$Peer$，直接相互通信。
     1.   当前比较流行的$P2P$应用有$PPlive，Bittorrent$和电驴等
     2.   对等模型的特点：不存在永远在线的服务器。每个主机既提供服务也可以提供服务。大大提高了系统效率和资源利用率，减轻了服务器的计算压力，消除了对某个服务器的完全依赖，可以将任务分配到各个结点上任意端系统或结点之间可以直接通信。结点间歇接入网络。结点可能改变$IP$地址。扩展性好。网络健壮性强，单个结点的失效不会影响其他部分的结点。占用较多内存，影响速度。

### DNS

$DNS$基于客户/服务器模式，运行在$UDP$上，使用$53$​号端口。

1.   层次域名空间：从概念上可将$DNS$分为$3$部分：层次域名空间、域名服务器和解析器。域名从右到左级别降低，最右边的是顶级域名，如`www.baidu.com`，`com`就是顶级域名，`baidu`就是二级域名，`www`就是三级域名。其实$com$后面应该有一个点，这个点就是根。

     1.   关于域名中的标号需要注意：标号中的英文不区分大小写,且除连字符`_`外不能使用其他的标点符号。每个标号不超过$63$个字符，多标号组成的完整域名最长不超过$255$个字符。

     2.   顶级域名$TLD(Top\; Level \;Domain)$分为：国家顶级域名（$cn$，$us$等），通用顶级域名（$com$：商业组织，$net$：信息服务提供机构等），基础结构域名/反向域名（$arpa$：用于反向域名解析。）
     3.   二级域名分为：类别域名（$com$：盈利机构，$edu$：教育机构等），行政区域名，自主注册域名（全球唯一）。

2.   域名服务器：域名到$IP$地址的解析由运行在域名服务器上的程序完成。一个服务器管辖的范围称为区。域名服务器可以高速缓存存储域名与$IP$地址值，但因为主机名和$IP$地址之间的映射不是永久的，所以**域名服务器将在一段时间后丢弃高速缓存中的信息**。

     1.   根域名服务器：知道所有顶级域名服务器域名与$IP$地址。若本地域名服务器不能解析首先交给根域名服务器。一共$13$个根域名服务器，$A$到$M$。用来管辖顶级域，**不直接进行地址转换**，而是告诉本地域名服务器下一步应该找哪个顶级域名服务器进行查询。
     2.   顶级域名服务器：管理该顶级域名服务器注册的所有二级域名。
     3.   权限（授权）域名服务器：负责一个区（域）的域名服务器。每台主机都必须在权限域名服务器上登记。权限域名服务器也可以是本地域名服务器。授权域名服务器一定能够将其管辖的主机名转换为该主机的$IP$地址。
     4.   本地域名服务器：当一个主机发出$DNS$查询请求时，这个请求报文就发送给本地域名服务器，是最近的服务器。

3.   域名解析过程：需要请求时通过本机$DNS$客户端构造一个$DNS$请求报文，以$UDP$数据报方式发送给本地域名服务器。均共使用$ 8$个$UDP$报文。

     1.   递归查询（靠别人）：主机请求$\to$本地域名服务器查找根域名服务器$\to$根域名服务器查找顶级域名服务器$\to$顶级域名服务器查找权限域名服务器，然后反过来
     2.   递归与迭代相结合的查询（默认，靠自己）：本地域名服务器分别查找根域名服务器，顶级域名服务器，权限域名服务器，最后返回主机。

### 文件传送协议$FTP$

服务器默认数据传输端口$20$，控制端口$21$，客户端的端口由程序自己分配。$FTP$基于$C/S$模型，使用$TCP$可靠的传输服务。屏蔽了各计算机系统的细节，因而适合于在异构网络中的任意计算机之间传送文件。

1.   工作原理：一个$FTP$服务器进程可同时为多个客户进程提供服务。FTP的服务器进程由两大部分组成，即一个主进程（负责接收新的请求）和若干从属进程（负责处理主进程分配给自己的单个请求）。登录使用用户名+密码或匿名登录。
2.   $FTP$协议连接流程
     1.   客户端和服务器端先建立$TCP$连接，端口是熟知端口` 21 `，称为控制连接
          1.   用来传输控制信息，以七位$ASCII$格式传输。
          2.   控制连接并不用来传送文件，**控制连接在整个会话期间一直保持打开状态**
     2.   等待客户进程发连接请求，确认是主动建立连接还是被动建立连接。简单概括为，
          1.   主动模式是“服务器”向连接到“客户端”的端口传送数据
          2.   被动模式是“客户端”向连接到“服务器”的端口传送数据
     3.   服务器端的控制进程在接收到FTP客户发来的文件传输请求后，就创建“**数据传送进程**”和“**数据连接**”。
          1.   **数据连接**用来连接客户端和服务器端的数据传送进程，**数据连接只保持一段时间，数据传输完成之后就断开**。
          2.   **数据传送进程**实际完成文件的传送，在传送完毕后关闭“数据传送连接”并结束运行
     4.   主动连接$PORT$是指服务器端主动发送请求和客户端进行连接，此时服务器端端口号固定是`20`。工作原理如下
          +   客户端连接到服务器的`21`端口，登录成功后要读取数据时，**客户端随机开放一个端口**，并发送命令告知服务器，服务器收到`PORT`命令和端口号后，通过`20`端口和客户端开放的端口连接，发送数据
     5.   被动连接$PASV$是指客户端发送请求和服务器端建立数据传送连接，此时**服务器端端口号不确定**，由两者协商得到，一般大于`1024`。
     6.   数据传输完成之后，数据连接断开，控制连接继续保持，直至两边发送断开请求。
3.   FTP协议传输模式
     1.   文本模式：$ASCII$模式，以文本序列传输数据。
     2.   二进制模式：$Binary$模式，以二进制序列传输数据。

---

简单文件传送协议TFTP：了解。端口号为$69$。使用$C/S$模型。使用$UDP$数据报。每次传输的数据报文中包含$512$字节，最后一次可不足$512$字节。

### 电子邮件

$SMTP$属于邮件发送协议，**用于用户代理向邮件服务器发送邮件或在邮件服务器之间发送邮件**。$POP$和$IMAP$属于邮件读取协议，**用于用户代理从邮件服务器读取邮件**。

1.   简单邮件传送$SMTP(Simple\; Mail\; Transfer\; Protocol)$：用户代理向邮件服务器发送邮件及在邮件服务器之间发送邮件时，$SMTP$客户将邮件$Push$到$SMTP$服务器。
     1.   建立在$TCP$连接上，使用的端口号为$25$。通信有三个过程：连接建立、邮件发送、连接释放
     2.   使用$C/S$模型，负责发送邮件的$SMTP$进程就是$SMTP$客户，负责接收邮件的进程就是$SMTP$服务器。这里的客户端和服务器可以相互交换
     3.   $SMTP$的缺点：不能传送可执行文件或其他二进制对象。仅限于传送$7$位$ASCII$码，不能传送其他非英语国家的文字。$SMTP$服务器会拒绝超过一定长度的邮件。

2.   通用因特网邮件扩充协议$MIME(Multipurpose\; Internet\; Mail\;Extensions)$：改善了$SMTP$的缺点，是$SMTP$的功能性扩展。$MIME$邮件可在现有的电子邮件程序和协议下传送。
3.   邮局协议$POP(Post \;Office\; Protocol)$，现在一般是$POP3$：建立于$TCP$连接上，端口号是$110$，使用$C/S$模型。使用明文在传输层上传输密码，不进行加密。与$SMTP$协议一样基于$ASCII$码，只能传输$ASCII$码。
4.   因特网信息访问协议$IMAP(Internet \;Message\; Access\; Protocol)$：当客户端打开$IMAP$服务器邮箱时，用户可以看到邮件的首部，只有打开某个邮件时才上传到用户本地计算机上。所以适用于低带宽的情况，避免取回不想取回的大数据。可以维护用户的状态信息。
5.   万维网邮件：此外，随着万维网的流行，目前出现了很多基于万维网的电子邮件，如$Hotmail$、$Gmail$等。这种电子邮件的特点是，用户浏览器与$Hotmail$或$Gmail$的邮件服务器之间的邮件发送或接收使用的是$HTTP$，而仅在不同邮件服务器之间传送邮件时才使用$SMTP$。

### 万维网WWW

1.   统一资源定位符$URL$：$Protocol://Host:Port/Path$，$URL$不区分大小写。$URL$可以使用$HTTP$也可以使用$FTP$。
     1.   协议$Protocol$指用什么协议来获取万维网文档，常见的协议有$http$、$ftp$等
     2.   主机$Host$是存放资源的主机在因特网中的域名或IP地址
     3.   端口$Port$和路径$Path$有时可省略。
2.   超文本传输协议$HTTP$：定义了浏览器即**万维网客户进程**怎样向万维网服务器请求文档，以及服务器如何传输文档。
     1.   服务器监听$TCP$运行于`80`端口，以$C/S$方式工作，面向事务。
     2.   $HTTP$协议的特点：无状态：无法记忆用户。无连接：交换$HTTP$报文之前不需要先建立$HTTP$连接（$HTTP$协议采用$TCP$连接，但是$HTTP$协议本身无连接）。
     3.   HTTP协议的连接：持久连接（每个网页元素对象的传输都需要单独建立一个$TCP$连接）和非持久连接（发送响应后仍然保持这条连接）
          1.   非持久连接：传输时间为该文档的传输时间（传输时间与文档大小成正比，每个引用也要算上）加上两倍往返时间即$2RTT$，一个$RTT$用于$TCP$连接，另一个$RTT$用于请求和接收文档
          2.   非流水线持久连接方式：客户在收到前一个响应后才能发出下一个请求
          3.   ※流水线持久连接方式：客户每遇到一个对象引用就立即发出一个请求，因而客户可以逐个地连续发出对各个引用对象的请求。**$HTTP/1.1$的默认方式是使用流水线的持久连接**。默认$TCP$链接的第三个报文携带http请求报文，之后发送的数据长度依照慢开始（假设理想条件没有重传和拥塞）算法进行传输
               +   画图！注意算不算$TCP$链接建立时间！

3.   HTTP协议报文：$HTTP$报文分为请求报文和响应报文，因为其面向文本$Text-Oriented$，所以报文中的每一个字段都是$ASCII$码串。HTTP请求报文和响应报文都由三个部分组成。从图6.14可以看出，这两种报文格式的区别就是开始行不同。请求报文与响应报文的第一行叫做开始行，用于互相区分是请求报文还是响应报文。在请求报文中的开始行称为请求行，而在响应报文中的开始行称为状态行。
     1.   请求报文中的`方法`字段是指命令，就是对所请求的对象进行什么操作，如获取/删除等等。
          1.   **GET**：请求指定资源的表示形式，使用GET的请求应仅检索数据。
          2.   **HEAD**：请求读取信息首部要求与GET请求相同的响应，==但没有响应正文==。
          3.   **POST**：将实体提交到指定资源，通常会导致服务器上状态或副作用的更改。
          4.   **CONNECT**：用于代理服务器。
     2.   状态码表明服务器当前的状态
          1.   $1xx$表示通知信息的，如请求收到了或正在处理。
          2.   $2xx$表示成功，如接受或知道了。
          3.   $3xx$表示重定向，如要完成请求还必须采取进一步的行动。
          4.   $4xx$表示客户的差错，如请求中有错误的语法或不能完成。
          5.   $5xx$表示服务器的差错，如服务器失效无法完成请求。

![image-20230803220326089](https://trouvaille-oss.oss-cn-beijing.aliyuncs.com/picList/202308032203189.png)